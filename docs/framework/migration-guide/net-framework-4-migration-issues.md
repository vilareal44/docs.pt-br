---
title: Problemas de migração do .NET Framework 4
description: Saiba mais sobre os problemas de migração entre o .NET Framework 3,5 Service Pack 1 e o .NET Framework 4, incluindo correções e alterações para conformidade e segurança de padrões.
ms.date: 05/02/2017
helpviewer_keywords:
- .NET Framework 4, migration
- application compatibility
ms.assetid: df478548-8c05-4de2-8ba7-adcdbe1c2a60
ms.openlocfilehash: bbb9a3803986c922fd1ef04a87cd1e230fc3d623
ms.sourcegitcommit: cf5a800a33de64d0aad6d115ffcc935f32375164
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/20/2020
ms.locfileid: "86475275"
---
# <a name="net-framework-4-migration-issues"></a>Problemas de migração do .NET Framework 4

Este artigo descreve os problemas de migração entre .NET Framework versão 3,5 Service Pack 1 e .NET Framework versão 4, incluindo correções, alterações de conformidade e segurança de padrões e alterações com base nos comentários dos clientes. A maioria dessas alterações não requer a modificação da programação dos seus aplicativos. Para aqueles que podem envolver modificações, consulte a coluna **alterações recomendadas** da tabela. Alterações notáveis são divididas por área, por exemplo, ASP.NET e Windows Presentation Foundation (WPF).

Para obter uma visão geral de nível superior dos problemas neste artigo, consulte [Guia de migração para .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff657133%28v=vs.100%29).

Para obter informações sobre novos recursos, consulte [What ' s New in .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms171868%28v=vs.100%29).

## <a name="aspnet-and-web"></a>ASP.NET e Web

Namespaces: <xref:System.Web> , <xref:System.Web.Mobile> , <xref:System.Web.Security> ,<xref:System.Web.UI.WebControls>

Assembly: System. Web (em System.Web.dll)

| Recurso  | Diferenças de 3.5 SP1 | Alterações recomendadas |
| -------- | ------------------------ | ------------------- |
| **Arquivos de definição do navegador** | Os arquivos de definição do navegador foram atualizados para incluir informações sobre dispositivos e navegadores novos e atualizados. Navegadores e dispositivos mais antigos como o Netscape Navigator foram removidos e navegadores e dispositivos mais novos como o Google Chrome e Apple iPhone foram adicionados.<br><br>Se seu aplicativo contiver definições do navegador personalizadas herdadas de uma das definições do navegador que foram removidas, você verá um erro.<br><br>O objeto <xref:System.Web.HttpBrowserCapabilities> (exposto pela propriedade da página `Request.Browse`) é orientada pelos arquivos de definição do navegador. Portanto, as informações retornadas ao acessar uma propriedade desse objeto no ASP.NET 4 talvez sejam diferentes das informações retornadas em uma versão anterior do ASP.NET. | Se seu aplicativo depender dos antigos arquivos de definição do navegador, será possível copiá-los da pasta a seguir:<br><br>*\\Navegadores de configuração do Windows Microsoft.NET \\ Framework \\ v 2.0.50727 \\ \\*<br><br>Copie os arquivos para a pasta de * \\ \\ navegadores de configuração* correspondente para ASP.NET 4. Depois de copiar os arquivos, execute a ferramenta de linha de comando [Aspnet_regbrowsers.exe](https://docs.microsoft.com/previous-versions/dotnet/netframework-3.5/ms229858(v=vs.90)). Para obter mais informações, consulte o [https://www.asp.net/mobile](/aspnet/mobile/overview) site. |
| **Aplicativos filho em execução em diferentes versões do ASP.NET** | Os aplicativos ASP.NET 4 configurados como filhos de aplicativos que executam versões anteriores do ASP.NET talvez falhem ao iniciar devido a erros de configuração ou de compilação. O erro específico que ocorre depende se o aplicativo é executado no IIS 6.0 ou no IIS 7 ou no IIS 7.5. | É possível fazer alterações nos arquivos de configuração dos aplicativos afetados para que o sistema de configuração reconheça corretamente o aplicativo ASP.NET 4. Para obter informações sobre as alterações que você deverá fazer, consulte a seção "ASP.NET 4 Child Applications Fail to Start When Under ASP.NET 2.0 or ASP.NET 3.5 Applications" (Aplicativos ASP.NET 4 filho falham ao iniciar nos Aplicativos ASP.NET 2.0 ou ASP.NET 3.5) no documento [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) (Alterações recentes do ASP.NET 4) no site da Web do ASP.NET. |
| **Alterações da ClientID** | A nova configuração `clientIDMode` no ASP.NET 4 permite especificar como o ASP.NET gera o atributo `id` para elementos HTML. Nas versões anteriores do ASP.NET, o comportamento padrão era equivalente à configuração `AutoID` do `clientIDMode`. A configuração padrão agora é `Predictable`. Para obter mais informações, consulte [ASP.NET Web Server Control Identification](https://docs.microsoft.com/previous-versions/aspnet/1d04y8ss%28v=vs.100%29) (Identificação de controles do servidor Web do ASP.NET). | Se você usar o Visual Studio para atualizar seu aplicativo do ASP.NET 2,0 ou ASP.NET 3,5, a ferramenta adicionará automaticamente uma configuração ao arquivo de Web.config que preserva o comportamento das versões anteriores do .NET Framework. No entanto, se você atualizar um aplicativo alterando o pool de aplicativos no IIS para o destino .NET Framework 4, o ASP.NET usará o novo modo por padrão. Para desabilitar o novo modo da ID do cliente, adicione a seguinte configuração ao arquivo Web.config:<br><br>`<pages clientIDMode="AutoID" />` |
| **CAS (segurança de acesso do código)** | Os recursos NET do ASP.NET 2.0 que foram adicionados no ASP.NET 3.5 usam o modelo CAS (Segurança de Acesso do Código) do .NET Framework 1.1 e .NET Framework 2.0. No entanto, a implementação da CAS no ASP.NET 4 foi substancialmente revisada. Como resultado, os aplicativos ASP.NET de confiança parcial que dependem de código confiável em execução no cache de assembly global talvez falhem com diversas exceções de segurança. Aplicativos de confiança parcial que dependem de grandes modificações na política de CAS do computador talvez falhem e gerem exceções de segurança também. | É possível reverter aplicativos ASP.NET 4 de confiança parcial para o comportamento do ASP.NET 1.1 e 2.0 usando o novo atributo `legacyCasModel` no elemento `trust`, conforme mostrado no exemplo a seguir:<br><br>`<trust level= "Medium" legacyCasModel="true" />`<br><br>Importante: reverter para o modelo CAS mais antigo talvez represente menos segurança.<br><br>Para obter mais informações sobre o novo modelo de segurança de acesso do código do ASP.NET 4, consulte [Segurança de acesso do código em aplicativos ASP.NET 4](https://docs.microsoft.com/previous-versions/dd984947(v=vs.100)). |
| **Arquivos de configuração** | Os arquivos de configuração raiz (o arquivo de machine.config e o arquivo de Web.config raiz) para .NET Framework e ASP.NET 4 foram atualizados para incluir a maioria das informações de configuração clichê encontradas nos arquivos de Web.config de aplicativos no ASP.NET 3,5. Devido à complexidade dos sistemas de configuração do IIS 7 e IIS 7.5 gerenciados, executar aplicativos ASP.NET 3.5 no ASP.NET 4 e no IIS 7 e IIS 7.5 pode resultar em erros do ASP.NET ou do IIS. | Atualize os aplicativos ASP.NET 3.5 para ASP.NET 4 usando as ferramentas de atualização de projeto no Visual Studio. O Visual Studio 2010 modifica automaticamente o arquivo Web.config do aplicativo ASP.NET 3.5 para conter as configurações apropriadas do ASP.NET 4.<br><br>No entanto, você pode executar aplicativos ASP.NET 3,5 usando o .NET Framework 4 sem recompilação. Nesse caso, talvez seja necessário modificar manualmente o arquivo de Web.config do aplicativo antes de executar o aplicativo em .NET Framework 4 e no IIS 7 ou IIS 7,5. A alteração específica que é necessário ser feita depende da combinação de software com a qual você está trabalhando, incluindo as versões do SP (Service Pack). Para obter informações sobre as combinações de software possíveis afetadas por essa alteração e como resolver problemas com combinações específicas, consulte a seção "Erros de configuração relacionados à nova configuração raiz do ASP.NET 4" no documento [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) (Alterações recentes do ASP.NET 4) no site da Web do ASP.NET. |
| **Renderização de controles** | Em versões anteriores do ASP.NET, alguns controles emitiam marcação que não podiam ser desabilitadas. Por padrão, esse tipo de marcação não é mais gerado no ASP.NET 4. As alterações de renderização afetam os seguintes controles:<br><br>\*Os `Image` `ImageButton` controles e não renderizam mais um `border="0"` atributo.<br>\*A `BaseValidator` classe e os controles de validação que derivam dele não renderizam mais texto vermelho por padrão.<br>\*O `HtmlForm` controle não processa um `name` atributo.<br>\*O `Table` controle não renderiza mais um `border="0"` atributo.<br><br>Os controles que não foram projetados para a entrada de usuário (por exemplo, o controle `Label`) não renderizarão mais o atributo `disabled="disabled"` se sua propriedade `Enabled` for definida como `false` (ou se eles herdarem essa configuração de uma caixa de controles). | Se você usar o Visual Studio para atualizar seu aplicativo do ASP.NET 2.0 ou do ASP.NET 3.5, a ferramenta adicionará automaticamente uma configuração ao arquivo Web.config que preservará a renderização herdada. No entanto, se você atualizar um aplicativo alterando o pool de aplicativos no IIS para o destino .NET Framework 4, o ASP.NET usará o novo modo de renderização por padrão. Para desabilitar o novo modo de renderização, adicione a seguinte configuração ao arquivo Web.config:<br><br>`<pages controlRenderingCompatibilityVersion="3.5" />` |
| **Manipuladores de eventos em documentos padrão** | O ASP.NET 4 renderiza o valor do atributo `action` do elemento `form` HTML como uma cadeia de caracteres vazia quando uma solicitação é feita em uma URL sem extensão que tem um documento padrão mapeado para ela. Em versões anteriores do ASP.NET, uma solicitação para `http://contoso.com` resultaria em uma solicitação para Default.aspx. Nesse documento, a marca `form` de abertura seria renderizada como no exemplo a seguir:<br><br>`<form action="Default.aspx" />`<br><br>No ASP.NET 4, uma solicitação para `http://contoso.com` também resulta em uma solicitação para Default.aspx, mas agora o ASP.NET renderiza a marca `form` de abertura HTML como no exemplo a seguir:<br><br>`<form action="" />`<br><br>Quando o atributo `action` é uma cadeia de caracteres vazia, o objeto `DefaultDocumentModule` do IIS cria uma solicitação filho para Default.aspx. Na maioria das condições, essa solicitação filho é transparente para o código do aplicativo e a página Default.aspx é executada normalmente. No entanto, uma eventual interação entre código gerenciado e o modo integrado do IIS 7 ou IIS 7.5 pode fazer páginas .aspx gerenciadas pararem de funcionar adequadamente durante a solicitação filho. Se ocorrerem as condições a seguir, a solicitação filho para um documento .aspx padrão resultará em um erro ou em um comportamento inesperado:<br><br>\*Uma página. aspx é enviada ao navegador com o `form` atributo do elemento `action` definido como "".<br>\*O formulário é Postado de volta para ASP.NET.<br>\*Um módulo HTTP gerenciado lê parte do corpo da entidade, como `Request.Form` ou `Request.Params` . Isso faz o corpo da entidade da solicitação POST ser lido na memória gerenciada. Como resultado, o corpo da entidade não está mais disponível para quaisquer módulos de código nativo em execução no modo integrado do IIS 7 ou do IIS 7.5.<br>\*O `DefaultDocumentModule` objeto IIS eventualmente é executado e cria uma solicitação filho para o documento default. aspx. No entanto, como o corpo da entidade já foi lido por um trecho de código gerenciado, não há nenhum corpo de entidade disponível para enviar a solicitação filho.<br>\*Quando o pipeline HTTP é executado para a solicitação filho, o manipulador para arquivos. aspx é executado durante a fase de execução do manipulador.<br><br>Como não há nenhum corpo de entidade, há nenhuma variável de formulário e nenhum estado de exibição. Portanto, não há nenhuma informação disponível para o manipulador de página .aspx para determinar qual evento (se houver) deve ser gerado. Como resultado, nenhum manipulador de eventos de postback para a página .aspx afetada é executado. | Para obter informações sobre como solucionar problemas que possam surgir como resultado dessa alteração, consulte “Event Handlers Might Not Be Not Raised in a Default Document in IIS 7 or IIS 7.5 Integrated Mode” (Manipuladores de eventos podem não ser gerados em um documento padrão no modo integrado do IIS 7 ou IIS 7.5) no documento [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) (Alterações recentes do ASP.NET 4) no site da Web do ASP.NET. |
| **Algoritmo de hash** | O ASP.NET usa algoritmos de hash e criptografia para ajudar a proteger dados como cookies de autenticação de formulários e estado de exibição. Por padrão, o ASP.NET 4 usa o algoritmo <xref:System.Security.Cryptography.HMACSHA256> para operações de hash em cookies e estado de exibição. As versões anteriores do ASP.NET usavam o algoritmo <xref:System.Security.Cryptography.HMACSHA1> mais antigo. | Se você executar aplicativos que combinam o ASP.NET 2.0 e o ASP.NET 4, em que dados como os cookies de autenticação de formulários devem funcionar em versões do .NET Framework, configure um aplicativo Web ASP.NET 4 para usar o algoritmo <xref:System.Security.Cryptography.HMACSHA1> mais antigo adicionando a seguinte configuração no arquivo Web.config:<br><br>`<machineKey validation="SHA1" />` |
| **Hospedando controles no Internet Explorer** | Não é mais possível hospedar controles do Windows Forms no Internet Explorer, porque há soluções melhores para hospedar controles na Web. Portanto, os assemblies IEHost.dll e IEExec.exe foram removidos do .NET Framework. | É possível usar as seguintes tecnologias para o desenvolvimento de controles personalizados em aplicativos Web:<br><br>\*Você pode criar um aplicativo do Silverlight e configurá-lo para ser executado fora do navegador. Para obter mais informações, consulte [Out-of-Browser Support](https://docs.microsoft.com/previous-versions/windows/silverlight/dotnet-windows-silverlight/dd550721%28v=vs.95%29) (Suporte à execução fora do navegador).<br>\*Você pode criar um aplicativo de navegador XAML (XBAP) para aproveitar os recursos do WPF (requer .NET Framework em computadores cliente). Para obter mais informações, consulte [visão geral de aplicativos de navegador XAML WPF](../wpf/app-development/wpf-xaml-browser-applications-overview.md). |
| **Métodos HtmlEncode e UrlEncode** | Os métodos `HtmlEncode` e `UrlEncode` das classes <xref:System.Web.HttpUtility> e <xref:System.Web.HttpServerUtility> foram atualizados para codificar o caractere de aspas simples (') da seguinte maneira:<br><br>\*O `HtmlEncode` método codifica instâncias de aspas simples como`&#39;`<br>\*O `UrlEncode` método codifica instâncias de aspas simples como`%27` | Em seu código, procure locais nos quais você usa os métodos `HtmlEncode` e `UrlEncode`, e certifique-se de que a alteração na codificação não resulte em uma alteração que possa afetar seu aplicativo. |
| **Erros HttpException em aplicativos ASP.NET 2.0** | Depois que o ASP.NET 4 tiver sido habilitado no IIS 6, os aplicativos ASP.NET 2.0 executados no IIS 6 (no Windows Server 2003 ou Windows Server 2003 R2) poderão gerar erros como o seguinte: `System.Web.HttpException: Path '/[yourApplicationRoot]/eurl.axd/[Value]' was not found.` | * Se não for necessário ter o ASP.NET 4 para executar o site da Web, remapeie o site para usar o ASP.NET 2.0.<br><br>-ou-<br><br>\*Se ASP.NET 4 for necessário para executar o site, mova quaisquer diretórios virtuais ASP.NET 2,0 filho para um site diferente que esteja mapeado para ASP.NET 2,0.<br><br>-ou-<br><br>\*Desabilitar URLs com extensão. Para obter mais informações, consulte "Aplicativos ASP.NET 2.0 podem gerar erros HttpException que referenciam eurl.axd" no documento [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) (Alterações recentes do ASP.NET 4) no site da Web do ASP.NET. |
| **Tipos de associação** | Alguns tipos (por exemplo, <xref:System.Web.Security.MembershipProvider>) usados na associação do ASP.NET foram movidos do System.Web.dll para o assembly System.Web.ApplicationServices.dll. Os tipos foram movidos para resolver as dependências de camadas de arquitetura entre os tipos no cliente e nos SKUs do .NET Framework estendido. | As bibliotecas de classes que foram atualizadas de versões anteriores do ASP.NET e que usarem os tipos de associação movidos poderão falhar ao compilar quando usadas em um projeto do ASP.NET 4. Nesse caso, adicione uma referência no projeto da biblioteca de classes ao System.Web.ApplicationServices.dll. |
| **Alterações no Controle de menu** | Alterações no controle <xref:System.Web.UI.WebControls.Menu> resultam no seguinte comportamento:<br><br>\*Se <xref:System.Web.UI.WebControls.MenuRenderingMode> for definido como `List` , ou se <xref:System.Web.UI.WebControls.MenuRenderingMode> for definido como `Default` e <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> for definido como `4.0` ou posterior, a <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> propriedade não terá nenhum efeito.<br>\*Se o caminho definido nas <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> Propriedades e contiver uma barra invertida ( \\ ), as imagens não serão renderizadas. (Nas versões anteriores do ASP.NET, o caminho podia incluir uma barra invertida.) | * Em vez de configurar a propriedade <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> para itens de menu individuais, defina o <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> ou <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> do controle pai <xref:System.Web.UI.WebControls.Menu>.<br><br>-ou-<br><br>Defina <xref:System.Web.UI.WebControls.MenuRenderingMode> como `Table` ou defina <xref:System.Web.UI.WebControls.MenuRenderingMode> como `Default` e defina <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> como `3.5`. Essas configurações fazem o controle <xref:System.Web.UI.WebControls.Menu> usar o layout baseado em tabela HTML usado em versões anteriores do ASP.NET.<br>\*Se o caminho na <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> propriedade ou <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> contiver uma barra invertida ( \\ ), substitua um caractere de barra (/). |
| **Assembly móvel no arquivo Web.config** | Nas versões anteriores do ASP.NET, uma referência ao assembly System.Web.Mobile.dll foi incluída no arquivo Web.config raiz na seção `assemblies` em `system.web`/`compilation`. Para melhorar o desempenho, a referência a esse assembly foi removida.<br><br>Observação: o assembly System.Web.Mobile.dll e os controles móveis do ASP.NET estão incluídos no ASP.NET 4, mas eles são preteridos. | Se você desejar usar tipos desse assembly, adicione uma referência ao assembly no arquivo Web.config raiz ou em um arquivo Web.config do aplicativo. |
| **Cache de saída** | No ASP.NET 1,0, um bug causou páginas em cache que especificavam uma `Location="ServerAndClient"` &euro; configuração de cache "output" para emitir um `Vary:*` cabeçalho HTTP na resposta. O efeito disso era informar os navegadores de clientes a nunca armazenar a página em cache localmente. No ASP.NET 1.1, o método <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> foi adicionado, que poderia ser chamado para suprimir o cabeçalho `Vary:*`. No entanto, os relatórios de bugs sugerem que os desenvolvedores não têm conhecimento do comportamento `SetOmitVaryStar` existente.<br><br>No ASP.NET 4, o cabeçalho HTTP `Vary:*` não é mais emitido com base em respostas que especificam a seguinte diretiva:<br><br>`<%@ OutputCache Location="ServerAndClient" %>`<br><br>Como resultado, o método <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> não é mais necessário para suprimir o cabeçalho `Vary:*`. Em aplicativos que especificam "ServerAndClient" para o atributo `Location`, as páginas poderão ser armazenadas em cache no navegador sem a necessidade de chamar <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>. | Se as páginas do aplicativo precisarem emitir `Vary:*`, chame o método <xref:System.Web.HttpResponse.AppendHeader%2A> conforme mostrado no exemplo a seguir:<br><br>`System.Web.HttpResponse.AppendHeader("Vary","*");`<br><br>Ou é possível alterar o valor do atributo `Location` do cache de saída para "Servidor". |
| **Análise da página** | O analisador de página para páginas da Web do ASP.NET (arquivos .aspx) e controles de usuário (arquivos .ascx) é mais rígido no ASP.NET 4 do que em versões anteriores do ASP.NET e ele sinaliza mais marcações como inválidas do que em versões anteriores. | Examine mensagens de erro produzidas quando uma página é executada e corrigem erros resultantes de marcação inválida. |
| **Tipos de Passport** | O suporte ao Passport incorporado no ASP.NET 2.0 é obsoleto e não tem mais suporte devido a alterações no Passport (agora SDK do Live ID). Como resultado, agora os tipos relacionados ao Passport no <xref:System.Web.Security> são marcados com o atributo `ObsoleteAttribute`. | Altere qualquer código que use tipos de passaporte no <xref:System.Web.Security> namespace (por exemplo, <xref:System.Web.Security.PassportIdentity> ) para usar o SDK do Windows Live ID. |
| **Informação PathInfo na propriedade FilePath** | O ASP.NET 4 não inclui mais o valor `PathInfo` nos valores de retorno de propriedades como <xref:System.Web.HttpRequest.FilePath>, <xref:System.Web.HttpRequest.AppRelativeCurrentExecutionFilePath> e <xref:System.Web.HttpRequest.CurrentExecutionFilePath>. Em vez disso, as informações `PathInfo` do estão disponíveis em <xref:System.Web.HttpRequest.PathInfo>. Por exemplo, imagine o fragmento da URL a seguir:<br><br>`/testapp/Action.mvc/SomeAction`<br><br>Em versões anteriores do ASP.NET, as propriedades <xref:System.Web.HttpRequest> têm os seguintes valores:<br><br>\* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc/SomeAction`<br>\*<xref:System.Web.HttpRequest.PathInfo>: (vazio)<br><br>No ASP.NET 4, as propriedades <xref:System.Web.HttpRequest> têm os seguintes valores:<br><br>\* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc`<br>\* <xref:System.Web.HttpRequest.PathInfo>: `SomeAction` | Em seu código, examine os locais nos quais você depende de propriedades da classe <xref:System.Web.HttpRequest> para retornar as informações do caminho; altere o código para refletir as alterações na maneira como as informações do caminho são retornadas. |
| **Validação de solicitação** | Para melhorar a validação de solicitação, a validação de solicitação do ASP.NET é invocada anteriormente no ciclo de vida da solicitação. Como resultado, a validação de solicitação é executada para solicitações que não são para arquivos .aspx, como para chamadas de serviço Web e para manipuladores personalizados. A validação de solicitação também estará ativa quando os módulos HTTP personalizados estiverem sendo executados no pipeline de processamento da solicitação.<br><br>Em decorrência dessa alteração, as solicitações de recursos que não sejam arquivos .aspx talvez gerem erros de validação de solicitação. Código personalizado executado no pipeline de solicitação (por exemplo, módulos HTTP personalizados) talvez gerem também erros de validação de solicitação. | Se necessário, é possível reverter para o antigo comportamento de ter apenas páginas .aspx disparando validação de solicitação por meio da seguinte configuração no arquivo de configuração da Web:<br><br>`<httpRuntime requestValidationMode="2.0" />`<br><br>Aviso: se você reverter para o comportamento antigo, certifique-se de que todo o código em manipuladores existentes, módulos e outros códigos personalizados executa verificações de entradas HTTP potencialmente inseguras que poderiam ser vetores de ataque XSS. |
| **Roteiros** | Se você criar um site da Web do sistema de arquivos no Visual Studio 2010 e ele estiver em uma pasta que contenha um ponto (.) no nome da pasta, o roteamento de URL não funcionará com segurança. Um erro 404 de HTTP é retornado de alguns caminhos virtuais. Isso ocorre porque o Visual Studio 2010 abre o Visual Studio Development Server que usa um caminho incorreto para o diretório virtual raiz. | * Na página **Propriedades** do site da Web baseado em arquivo, altere o atributo **Caminho virtual** para "/".<br><br>-ou-<br><br>\*Crie um projeto de aplicativo Web em vez de um projeto de site. Os projetos de aplicativo Web não apresentam esse problema e o roteamento de URL funcionará mesmo se a pasta de projeto tiver um ponto no nome.<br><br>-ou-<br><br>\*Crie um site da Web baseado em HTTP que esteja hospedado no IIS. Os sites da Web hospedados pelo IIS podem ter pontos do caminho virtual, bem como a pasta do arquivo de projeto. |
| **Sites do SharePoint** | Se você tentar executar um site da Web ASP.NET 4 implantado como filho de um site da Web do SharePoint que contém um nível de confiança parcial personalizado nomeado `WSS_Minimal`, você verá o seguinte erro:<br><br>`Could not find permission set named 'ASP.Net'.` | No momento, nenhuma versão do SharePoint é compatível com o ASP.NET. Como resultado, você não deverá tentar executar um site da Web do ASP.NET 4 como um filho de um site da Web do SharePoint. |
| **Padrões XHTML 1.1** | Para habilitar a conformidade com o XHTML 1,1 para novos sites, os controles ASP.NET no .NET Framework 4 irão gerar HTML compatível com XHTML 1,1. Essa renderização é habilitada usando a seguinte opção no arquivo Web.config dentro do elemento `<system.Web>`:<br><br>`<pages controlRenderingCompatibilityVersion="4.0"/>`<br><br>Essa opção é definida, por padrão, como 4.0. Os projetos da Web atualizados do Visual Studio 2008 têm a configuração 3.5 habilitada para compatibilidade. | Nenhum. |

## <a name="core"></a>Núcleo

### <a name="general-features"></a>Recursos gerais

| Recurso | Diferenças de 3.5 SP1 | Alterações recomendadas |
| ------- | ------------------------ | ------------------- |
| **CardSpace** | O Windows CardSpace não está mais incluído no .NET Framework; Ele é fornecido separadamente. | Baixe o Windows CardSpace do [Centro de Download da Microsoft](https://go.microsoft.com/fwlink/?LinkId=199868). |
| **Arquivos de configuração** | Foram feitas correções em como .NET Framework acessa os arquivos de configuração do aplicativo. | Se o arquivo de configuração do aplicativo for nomeado *application-name.config*, renomeie-o como *application-name.exe.config*. Por exemplo, renomeie *MyApp.config* para *MyApp.exe.config*. |
| **Compilador de código C#** | As `Compiler` `CompilerError` classes,, e `ErrorLevel` que estavam no <xref:Microsoft.CSharp> namespace não estão mais disponíveis e seu assembly (cscompmgd.dll) não está mais incluído em .NET Framework. | Use a classe <xref:System.CodeDom.Compiler.CodeDomProvider> e outras classes no namespace <xref:System.CodeDom.Compiler>. Para obter mais informações, consulte [Usando o CodeDOM](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/y2k85ax6%28v=vs.100%29). |
| **Hospedagem** (API não gerenciada) | Para melhorar os recursos de hospedagem, algumas APIs de ativação de hospedagem foram preteridas. Os recursos de execução lado a lado do processo permitem que um aplicativo carregue e inicie várias versões do .NET Framework no mesmo processo. Por exemplo, você pode executar aplicativos que carregam suplementos (ou componentes) baseados em .NET Framework 2,0 SP1 e suplementos com base no .NET Framework 4 no mesmo processo. Componentes mais antigos continuam usando a versão mais antiga do .NET Framework e os novos usam a nova versão do .NET Framework. | Use as configurações descritas na [Execução lado a lado em processo](../deployment/in-process-side-by-side-execution.md). |
| **Novo modelo de segurança** | A política de CAS (segurança de acesso ao código) foi desativada e substituída por um modelo simplificado, conforme descrito em [alterações de segurança no .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd233103%28v=vs.100%29). | Talvez sejam necessárias modificações se você depender do CAS em seus aplicativos. Para obter mais informações, consulte [Compatibilidade de política de segurança de acesso de código e migração](../misc/code-access-security-policy-compatibility-and-migration.md). |

### <a name="date-and-time"></a>Data e Hora

Namespace<xref:System>

Assembly: mscorlib (no mscorlib.dll)

| Recurso | Diferenças de 3.5 SP1 | Alterações recomendadas |
| ------- | ------------------------ | ------------------- |
| **Horário de verão** | Para ser consistente com o relógio do sistema, agora as propriedades de tempo (como <xref:System.TimeZoneInfo.Local> e <xref:System.DateTime.Now>) usam regras do sistema operacional, em vez de outros dados do .NET Framework para operações de horário de verão. | Nenhum. |
| **Formatação de cadeia de caracteres** | Para dar suporte à formatação que faz diferenciação de culturas, a estrutura <xref:System.TimeSpan> inclui novas sobrecargas dos métodos `ToString`, `Parse` e `TryParse` além dos novos métodos `ParseExact` e `TryParseExact`. | Nenhum. |

### <a name="globalization"></a>Globalização

Para obter uma lista de novas culturas neutras e específicas, consulte [Novidades sobre globalização e localização](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd997383%28v=vs.100%29).

Namespace<xref:System.Globalization>

Assembly: mscorlib (no mscorlib.dll)

| Recurso | Diferenças de 3.5 SP1 | Alterações recomendadas |
| ------- | ------------------------ | ------------------- |
| **Nomes de cultura** | As alterações de nome a seguir afetam as culturas alemã, divehi e africana:<br><br>\*<xref:System.Globalization.CultureAndRegionInfoBuilder.CurrencyEnglishName>: O nome da moeda para a cultura alemão (Suíça) (de-ch) foi alterado de "SFR". para "Fr.".<br>\*<xref:System.Globalization.DateTimeFormatInfo.LongDatePattern>: O padrão de data por extenso para a cultura divehi (Maldivas) (dv-MV) mudou de "dd/MMMM/aaaa" para "dd/mm/aaaa".<br>\*<xref:System.Globalization.DateTimeFormatInfo.PMDesignator>: Às P.M. P.M. da cultura africâner (África do Sul) (af-ZA) foi alterado de "nm" para "PM". | Observe as alterações no nome da cultura. |
| **Parâmetro LCID** | Para ser consistente com o comportamento esperado nas configurações do servidor de automação, o CLR não passa mais a cultura atual para o parâmetro `LCID` para aplicativos baseados em COM não gerenciados. Em vez disso, ele passa 1033 (en-us) para a cultura. | Nenhuma modificação necessária, exceto para aplicativos nativos que exigem uma cultura especificada. |
| **Tipos de cultura obsoletos** | Agora os tipos de cultura <xref:System.Globalization.CultureTypes> e <xref:System.Globalization.CultureTypes> estão obsoletos.<br><br>Para compatibilidade com versões anteriores, agora o <xref:System.Globalization.CultureTypes> retorna culturas neutras e específicos incluídas com a versão anterior do .NET Framework e agora o <xref:System.Globalization.CultureTypes> retorna uma lista vazia. | Use outros valores da enumeração <xref:System.Globalization.CultureTypes>. |
| **Recuperação da cultura** | A partir do Windows 7, .NET Framework 4 recupera informações de cultura do sistema operacional em vez de armazenar os dados em si. Além disso, .NET Framework sincroniza com o Windows para classificação e maiúsculas e minúsculas de dados. | Nenhum. |
| **Padrões Unicode 5.1** | .NET Framework agora dá suporte a todos os caracteres Unicode 5,1, uma adição de aproximadamente 1400 caracteres. Os caracteres adicionais incluem novos símbolos, setas, marcas diacríticas, pontuação, símbolos matemáticos, ideogramas e traços CJK, caracteres numéricos malaiala e télugo adicionais e vários caracteres birmanês, latino, árabe, grego, mongol e cirílico adicionais. Há suporte para os novos scripts a seguir com Unicode 5.1: caracteres sudanês, lepcha, ol chiki, vai, saurashtra, kayah li, rejang, gurmukhi, oriá, tâmil, télugo e malaiala e Cham. | Nenhum. |

### <a name="exceptions"></a>Exceções

Namespaces: <xref:System> ,<xref:System.Runtime.ExceptionServices>

Assembly: mscorlib (no mscorlib.dll)

| Recurso | Diferenças de 3.5 SP1 | Alterações recomendadas |
| ------- | ------------------------ | ------------------- |
| **Exceções do estado de processo corrompido** | O CLR não oferece mais exceções do estado de processo corrompido a manipuladores de exceção no código gerenciado. | Essas exceções indicam que o estado de um processo foi corrompido. Não é recomendável executar o aplicativo nesse estado.<br><br>Para obter mais informações, consulte o <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> e a entrada [tratamento de exceções de estado corrompidas](https://docs.microsoft.com/archive/msdn-magazine/2009/february/clr-inside-out-handling-corrupted-state-exceptions) na MSDN Magazine. |
| **Exceções do mecanismo de execução** | Agora o <xref:System.ExecutionEngineException> é obsoleto, porque uma exceção capturável permitirá que um processo instável continue sendo executado. Essa alteração melhora a confiabilidade e a previsibilidade no runtime. | Use um <xref:System.InvalidOperationException> para indicar a condição. |

### <a name="reflection"></a>Reflexão

Namespace<xref:System.Reflection>

Assembly: mscorlib (no mscorlib.dll)

| Recurso | Diferenças de 3.5 SP1 | Alterações recomendadas |
| ------- | ------------------------ | ------------------- |
| **Algoritmos de hash do assembly** | A propriedade <xref:System.Reflection.AssemblyName.HashAlgorithm> retorna <xref:System.Configuration.Assemblies.AssemblyHashAlgorithm>, pois o runtime não conhece o algoritmo de hash do assembly referenciado quando o assembly não está carregado. (Isso se refere ao uso da propriedade em um assembly referenciado como o retornado pelo método <xref:System.Reflection.Assembly.GetReferencedAssemblies%2A>.) | Nenhum. |
| **Carregamento de assembly** | Para evitar o carregamento redundante de assemblies e para poupar espaço de endereço virtual, agora o CLR carrega assemblies usando apenas a função `MapViewOfFile` Win32. Ele também não chama mais a função `LoadLibrary`.<br><br>Essa alteração afeta os aplicativos de diagnóstico das seguintes maneiras:<br><br>\*Um <xref:System.Diagnostics.ProcessModuleCollection> não conterá mais nenhum módulo de uma biblioteca de classes (arquivo. dll), conforme obtido de uma chamada para `Process.GetCurrentProcess().Modules` .<br>\*Os aplicativos Win32 que usam a `EnumProcessModules` função não verão todos os módulos gerenciados listados. | Nenhum. |
| **Tipo declarativo** | Agora a propriedade <xref:System.Type.DeclaringType> retorna null corretamente quando o tipo não tem um tipo declarativo. | Nenhum. |
| **Delegados** | Agora um delegado gera um <xref:System.ArgumentNullException> em vez de um <xref:System.NullReferenceException> quando um valor null é passado para o construtor do delegado. | Certifique-se de que qualquer tratamento de exceção capture <xref:System.ArgumentNullException>. |
| **Alteração no local do cache de assembly global** | Para assemblies do .NET Framework 4, o cache de assembly global foi movido do diretório Windows (%WINDIR%) para o subdiretório Microsoft.Net (*%WINDIR%\\Microsoft.Net*). Os assemblies de versões anteriores continuam no diretório mais antigo.<br><br>A enumeração [ASM_CACHE_FLAGS](../unmanaged-api/fusion/asm-cache-flags-enumeration.md) não gerenciada contém o novo sinalizador `ASM_CACHE_ROOT_EX`. Esse sinalizador obtém o local do cache para assemblies do .NET Framework 4, que podem ser obtidos pela função [GetCachePath](../unmanaged-api/fusion/getcachepath-function.md). | Nenhum, supondo que os aplicativos não usam caminhos explícitos para assemblies, que não é uma prática recomendada. |
| **Ferramenta de Cache de Assembly Global** | A [Gacutil.exe (Ferramenta do cache de assembly global)](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ex0ss12c%28v=vs.100%29) não dá mais suporte ao visualizador de plugin shell. | Nenhum. |

### <a name="interoperability"></a>Interoperabilidade

Namespace<xref:System.Runtime.InteropServices>

Assembly: mscorlib (no mscorlib.dll)

| Recurso | Diferenças de 3.5 SP1 | Alterações recomendadas |
| ------- | ------------------------ | ------------------- |
| **Tamanho do buffer** (API não gerenciada) | Para economizar memória, a funcionalidade do parâmetro `pBufferLengthOffset` para o método [ICorProfilerInfo2::GetStringLayout](../unmanaged-api/profiling/icorprofilerinfo2-getstringlayout-method.md) foi alterada para corresponder ao parâmetro `pStringLengthOffset`. Ambos os parâmetros agora apontam para o local de deslocamento do tamanho da cadeia de caracteres. O tamanho do buffer foi removido da representação da classe da cadeia de caracteres. | Remova qualquer dependência do tamanho do buffer. |
| **Depuração JIT** | Para simplificar o registro de depuração JIT (Just-In-Time), agora o depurador do .NET Framework usa apenas a chave do Registro AeDebug, que controla o comportamento de depuração JIT para o código nativo. Essa alteração resulta no seguinte:<br><br>\*Você não pode mais registrar dois depuradores diferentes para código gerenciado e nativo.<br>\*Não é mais possível iniciar o depurador automaticamente para um processo não interativo, mas você pode solicitar ao usuário um processo interativo.<br>\*Você não será notificado quando o depurador falhar ao iniciar ou quando não houver um depurador registrado que deva ser iniciado.<br>\*Não há mais suporte para as políticas de inicialização automática que dependem da interatividade do aplicativo. | Ajuste as operações de depuração conforme necessário. |
| **Invocação de plataforma** | Para melhorar o desempenho na interoperabilidade com código não gerenciado, agora as convenções de chamada incorretas em uma invocação de plataforma geram falhas. Nas versões anteriores, a camada de marshaling resolvia esses erros na pilha. | A depuração dos seus aplicativos no Microsoft Visual Studio alertam você sobre esses erros para que você possa corrigi-los.<br><br>Se você tiver binários que não podem ser atualizados, poderá incluir o [\<NetFx40_PInvokeStackResilience>](../configure-apps/file-schema/runtime/netfx40-pinvokestackresilience-element.md) elemento no arquivo de configuração do aplicativo para permitir que os erros de chamada sejam resolvidos na pilha como nas versões anteriores. No entanto, isso pode afetar o desempenho do seu aplicativo. |
| **Interfaces removidas** (API não gerenciada) | Para evitar que os desenvolvedores se confundam, as interfaces a seguir foram removidas porque elas não forneciam nenhum cenário de tempo de execução útil e o CLR não fornecia nem aceitava nenhuma implementação:<br><br>\* **INativeImageINativeImageDependency**<br>\* **INativeImageInstallInfo**<br>\* **INativeImageEvaluate**<br>\* **INativeImageConverter**<br>\* **ICorModule**<br>\* **IMetaDataConverter** | Nenhum. |

## <a name="data"></a>Dados

Esta seção descreve problemas de migração para usar conjuntos de dados e clientes SQL, o Entity Framework, LINQ to SQL e os servidores de dados WCF (anteriormente conhecidos como Serviços de Dados ADO.NET).

### <a name="dataset-and-sql-client"></a>DataSet and Cliente do SQL

A tabela a seguir descreve melhorias em recursos que anteriormente tinham limitações ou outros problemas.

Namespaces: <xref:System.Data> , <xref:System.Data.Objects.DataClasses> ,<xref:System.Data.SqlClient>

Assemblies: System. Data (em System.Data.dll), System. Data. Entity (em System.Data.Entity.dll)

| Recurso | Diferenças de 3.5 SP1 |
| ------- | ------------------------ |
| **Cenários POCO** | A interface <xref:System.Data.Objects.DataClasses.IRelatedEnd> tem novos métodos para melhorar seu uso em cenários POCO (Objeto CLR Básico). Esses novos métodos usam um <xref:System.Object> em vez de uma entidade <xref:System.Data.Objects.DataClasses.IEntityWithRelationships> como parâmetro. |
| **Edição de linhas** | O método <xref:System.Collections.IList.IndexOf%2A>, conforme implementado pela classe <xref:System.Data.DataView>, agora retorna corretamente o valor de uma linha que está sendo editada, em vez de retornar -1. |
| **Eventos** | Agora o evento <xref:System.Data.DataRowView.PropertyChanged> é gerado quando uma linha está em um estado modificado e o método <xref:System.Data.DataRow.RejectChanges%2A> é chamado. Essa alteração facilita a criação de controles de interface do usuário que expõem o conteúdo de um objeto <xref:System.Data.DataSet>. |
| **Exceções** | Agora o método <xref:System.Data.SqlClient.SqlCommand.Prepare%2A> gera um <xref:System.InvalidOperationException> quando uma conexão não está definida ou aberta em vez de um <xref:System.NullReferenceException>. |
| **Mapeamento de exibições** | Agora os erros de mapeamento de visualização da consulta são detectados em tempo de design em vez de gerar um tempo de execução <xref:System.NullReferenceException>.<br><br>Agora a validação do mapeamento detecta o erro no qual dois conjuntos de associações no CSDL (linguagem de definição de esquema conceitual) são mapeados para a mesma coluna. |
| **Transações** | Se um aplicativo tentar executar uma instrução em uma conexão após uma transação ter sido concluída (inclusive anulada ou revertida), agora um <xref:System.InvalidOperationException> é gerado. As versões anteriores não geravam uma exceção e permitiam que você executasse comandos adicionais mesmo se uma transação fosse abortada. |

### <a name="entity-framework"></a>Entity Framework

A tabela a seguir descreve melhorias em recursos que anteriormente tinham limitações ou outros problemas.

Namespaces: <xref:System.Data> , <xref:System.Data.Objects> ,<xref:System.Data.Objects.DataClasses>

Assemblies: System. Data. Entity (em System.Data.Entity.dll)

| Recurso | Diferenças de 3.5 SP1 |
| ------- | ------------------------ |
| **Objetos de entidade** | Agora há uma paridade entre o método <xref:System.Data.Objects.ObjectContext.Detach%2A> e o estado do objeto de entidade quando o método <xref:System.Data.Objects.ObjectContext.SaveChanges%2A> é chamado. Essa consistência aprimorada impede que exceções inesperadas sejam lançadas. |
| **Entity SQL** | As regras foram aprimoradas para resoluções de identificador no Entity SQL.<br><br>O analisador do Entity SQL melhorou a lógica para resolver os identificadores de partes múltiplas. |
| **Anotações estruturais** | Agora o Entity Framework reconhece anotações estruturais. |
| **Consultas** | As seguintes melhorias foram feitas em consultas:<br><br>\*Uma `GroupBy` consulta que usa uma chave nula em uma coleção vazia não retornará nenhuma linha, independentemente se houver seleções adicionais na consulta.<br>\*O SQL gerado no LINQ e as consultas do Entity-SQL agora tratam parâmetros de cadeia de caracteres como valores não Unicode por padrão. |

### <a name="linq-to-sql"></a>LINQ to SQL

A tabela a seguir descreve melhorias em recursos que anteriormente tinham limitações ou outros problemas.

Namespace<xref:System.Data.Linq>

Assembly: System. Data. Linq (no System.Data.Linq.dll)

| Recurso | Diferenças de 3.5 SP1 |
| ------- | ------------------------ |
| **Eventos** | Uma coleção <xref:System.Data.Linq.EntitySet%601> agora gera o evento <xref:System.Data.Linq.EntitySet%601.ListChanged> para adicionar e remover as operações quando o <xref:System.Data.Linq.EntitySet%601> é descarregado, além de gerar o evento quando a coleção é carregada. |
| **Consultas** | `Skip(0)` não é mais ignorado em chamadas LINQ to SQL. Como resultado, as consultas que têm esse método podem se comportar de maneira diferente. Por exemplo, em alguns casos, uma `OrderBy` cláusula é necessária com `Skip(0)` , e a consulta agora lançará uma <xref:System.NotSupportedException> exceção se a `OrderBy` cláusula não tiver sido incluída. |

### <a name="wcf-data-services"></a>WCF Data Services

A tabela a seguir descreve melhorias em recursos que anteriormente tinham limitações ou outros problemas.

Namespaces: <xref:System.Data.Services> , <xref:System.Data.Services.Client> , <xref:System.Data.Services.Common> ,<xref:System.Data.Services.Providers>

Assemblies: System. Data. Services (em System.Data.Services.dll), System. Data. Services. Client (em System.Data.Services.Client.dll)

| Recurso | Diferenças de 3.5 SP1 |
| ------- | ------------------------ |
| **Conteúdo binário em lote** | Agora o WCF Data Services dá suporte ao conteúdo binário em lote em solicitações e respostas. |
| **Interceptadores de alteração** | Agora os interceptadores de alteração são executados para uma solicitação de exclusão.<br><br>Um interceptador de alteração é um método executado sempre que uma solicitação é recebida pelo servidor para modificar uma entidade no conjunto de entidades. Ele é executado antes que a solicitação de entrada é executada. O interceptador de alteração fornece acesso à entidade que está sendo alterada e à operação que está sendo executada nela. |
| **Exceções** | Agora as condições a seguir lançam exceções mais úteis em vez de um <xref:System.NullReferenceException>:<br><br>\*Um <xref:System.ServiceProcess.TimeoutException> quando uma chamada para um serviço de dados atinge o tempo limite.<br>\*Um <xref:System.Data.Services.Client.DataServiceRequestException> quando uma solicitação inadequada é feita em um serviço de dados.<br><br>Em seus aplicativos, você deve alterar o tratamento de exceções para capturar novas exceções. |
| **Cabeçalhos** | As seguintes melhorias foram feitas em cabeçalhos:<br><br>\*WCF Data Services agora rejeita corretamente um `eTag` cabeçalho que tem um valor não especificado.<br>\*WCF Data Services agora retorna um erro e não executa a solicitação de uma solicitação de exclusão para um link quando um `if-*` cabeçalho está na solicitação.<br>\*WCF Data Services agora retorna um erro para o cliente no formato (Atom, JSON) que o cliente especificou no cabeçalho Accept. |
| **Leitor JSON** | Agora o leitor JSON (JavaScript Object Notation) retorna corretamente um erro quando ele lê o caractere de escape barra invertida única ("\\"), quando ele processa o conteúdo JSON enviado para um Serviço de Dados do WCF. |
| **Mesclagens** | As seguintes melhorias foram feitas na enumeração <xref:System.Data.Services.Client.MergeOption>:<br><br>\*A <xref:System.Data.Services.Client.MergeOption> opção de mesclagem não modifica mais a entidade no cliente como resultado de qualquer resposta subsequente de um serviço de dados.<br>\*A <xref:System.Data.Services.Client.MergeOption> opção agora é consistente entre o SQL dinâmico e as atualizações baseadas em procedimento armazenado. |
| **Solicitações** | O método <xref:System.Data.Services.DataService%601.OnStartProcessingRequest%2A> agora é chamado antes que uma solicitação aos serviços de dados seja processada. Isso permite que a solicitação funcione corretamente para os serviços <xref:System.Data.Services.Providers.ServiceOperation>. |
| **Fluxos** | O WCF Data Services não fecha mais o fluxo subjacente para operações de leitura e de gravação. |
| **URIs** | A saída de URIs pelo cliente WCF Data Services foi corrigida. |

## <a name="windows-communication-foundation-wcf"></a>Windows Communication Foundation (WCF)

A tabela a seguir descreve melhorias em recursos que anteriormente tinham limitações ou outros problemas.

| Recurso | Diferenças de 3.5 SP1 |
| ------- | ------------------------ |
| **Arquivos de configuração** | Para habilitar a herança de comportamentos por meio da hierarquia do arquivo de configuração, agora o WCF dá suporte à mesclagem em arquivos de configuração.<br><br>Agora o modelo de herança de configuração foi expandido para permitir que os usuários definam os comportamentos que serão aplicados a todos os serviços em execução no computador.<br><br>Talvez você encontre alterações de comportamento se houver comportamentos com o mesmo nome em diferentes níveis da hierarquia. |
| **Hospedagem do serviço** | Não é mais possível especificar o elemento de configuração `<serviceHostingEnvironment>` no nível de serviço, adicionando o atributo `allowDefinition="MachineToApplication"` à definição do elemento.<br><br>Especificar o elemento `<serviceHostingEnvironment>` no nível de serviço é tecnicamente incorreto e causa um comportamento inconsistente. |

## <a name="windows-presentation-foundation-wpf"></a>Windows Presentation Foundation (WPF)

### <a name="applications"></a>Aplicativos

Namespaces: <xref:System.Windows> ,<xref:System.Windows.Controls>

Assemblies: PresentationFramework (no PresentationFramework.dll)

| Recurso | Diferenças de 3.5 SP1 | Alterações recomendadas |
| ------- | ------------------------ | ------------------- |
| **Tratamento de exceção** | Para permitir que os erros sejam detectados mais cedo, o WPF lança um <xref:System.Reflection.TargetInvocationException> e define a propriedade <xref:System.Exception.InnerException> como exceções críticas, como <xref:System.NullReferenceException>, <xref:System.OutOfMemoryException>, <xref:System.StackOverflowException> e <xref:System.Security.SecurityException>, em vez de capturar a exceção original. | Nenhum. |
| **Recursos vinculados** | Para facilitar a vinculação, os arquivos de recurso (como imagens) localizados em um local diferente da estrutura de pasta do projeto usam o caminho completo do arquivo de recurso em vez de apenas do nome de arquivo, como a ID do recurso quando o aplicativo é criado. O aplicativo será capaz de localizar os arquivos em tempo de execução. | Nenhum. |
| **Aplicativos de confiança parcial** | Para ver as considerações de segurança, os aplicativos baseados no Windows executados em confiança parcial e que contêm um controle <xref:System.Windows.Controls.WebBrowser> ou um controle <xref:System.Windows.Controls.Frame> que contém o HTML lançará um <xref:System.Security.SecurityException> quando o controle for criado.<br><br>Os aplicativos de navegador lançarão uma exceção e exibirão uma mensagem se todas as seguintes condições forem atendidas:<br><br>\*O aplicativo está em execução no Firefox.<br>\*O aplicativo está sendo executado em confiança parcial na zona da Internet de sites não confiáveis.<br>\*O aplicativo contém um <xref:System.Windows.Controls.WebBrowser> controle ou um <xref:System.Windows.Controls.Frame> controle que contém HTML.<br><br>Os aplicativos que são executados de sites confiáveis ou da zona da intranet não serão afetados. | Em seus aplicativos de navegador, é possível facilitar essa alteração seguindo um destes procedimentos:<br><br>\*Execute o aplicativo de navegador em confiança total.<br>\*Faça com que os clientes adicionem o site do aplicativo à zona de sites confiáveis.<br>\*Fazer com que os clientes executem o aplicativo no Internet Explorer. |
| **Dicionários de recursos** | Para melhorar os dicionários de recurso de nível de tema e impedir que eles mudem, agora os recursos congeláveis definidos em um dicionário de recurso e mesclados em um dicionário de nível de tema são sempre marcados como congelados e são imutáveis. Esse é o comportamento esperado para recursos congeláveis. | Os aplicativos que modificam um recurso definido em um dicionário mesclado de nível de tema devem clonar o recurso e modificar a cópia clonada. Como alternativa, o recurso poderá ser marcado `x:Shared="false"` para que o <xref:System.Windows.ResourceDictionary> crie uma nova cópia toda vez que o recurso for consultado. |
| **Windows 7** | Para fazer os aplicativos WPF funcionarem melhor no Windows 7, as seguintes melhorias foram feitas para corrigir o comportamento de uma janela:<br><br>\*Os Estados de encaixe e gesto agora funcionam conforme o esperado com base nas interações do usuário.<br>\*Os comandos da barra de tarefas **dispõem de janelas em cascata, mostrar janelas empilhadas**e **Mostrar janelas lado a lado** agora têm o comportamento correto e atualizam as propriedades apropriadas.<br>\*As `Top` `Left` Propriedades,, e `Width` `Height` para uma janela maximizada ou minimizada agora contêm o local de restauração correto da janela em vez de outros valores, dependendo do monitor. | Nenhum. |
| **Transparência e estilo do Windows** | Um <xref:System.InvalidOperationException> será gerado se você tentar definir <xref:System.Windows.Window.WindowStyle> como um valor diferente de <xref:System.Windows.WindowStyle> quando <xref:System.Windows.Window.AllowsTransparency> for `true` e <xref:System.Windows.WindowState> for <xref:System.Windows.WindowState>. | Se for necessário alterar o <xref:System.Windows.Window.WindowStyle> quando <xref:System.Windows.Window.AllowsTransparency> for `true`, será possível chamar a função `SetWindowLongPtr` Win32. |
| **Visualizador XPS** | O WPF não inclui o XPSEP (Microsoft XML Paper Specification Essentials Pack). O XPSEP é incluído com o Windows 7 e o Windows Vista.<br><br>Em um computador que esteja executando o Windows XP sem .NET Framework 3,5 SP1 instalado, a impressão usando uma API do WPF diferente daquela em dependerá <xref:System.Windows.Controls.PrintDialog> do winspool. Alguns recursos da impressora não serão relatados e algumas configurações da impressora não serão aplicadas durante a impressão. | Se necessário, instale o [Microsoft XML Paper Specification Essentials Pack](https://www.microsoft.com/en-us/download/details.aspx?id=11816). |

### <a name="controls"></a>Controles

Namespaces: <xref:System.Windows> , <xref:System.Windows.Controls> , <xref:System.Windows.Data> ,<xref:System.Windows.Input>

Assemblies: PresentationFramework (em PresentationFramework.dll), PresentationCore (em PresentationCore.dll), WindowsBase (em WindowsBase.dll)

| Recurso | Diferenças de 3.5 SP1 | Alterações recomendadas |
| ------- | ------------------------ | ------------------- |
| **Caixas de diálogo** | Para aumentar a confiabilidade, o método <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> é chamado no mesmo thread que criou o controle <xref:Microsoft.Win32.FileDialog>. | Certifique-se de criar um controle <xref:Microsoft.Win32.FileDialog> e de chamar o método <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> no mesmo thread. |
| **Janelas flutuantes** | Para corrigir a lógica de restauração de foco que mantém incorretamente a reativação de uma janela flutuante (fazendo-a ser exibida como uma caixa de diálogo modal), agora a restauração de foco será evitada se o candidato não for um filho da janela. | Nenhum. |
| **Itens em coleções** | Quando um item é movido ou adicionado a uma coleção subjacente, ele será exibido no <xref:System.Windows.Data.CollectionView> no mesmo local relativo se o <xref:System.Windows.Data.CollectionView> não for classificado. Isso fornece consistência entre a posição do item na coleção e no <xref:System.Windows.Data.CollectionView> associado. | Use o método <xref:System.Windows.Controls.ItemContainerGenerator.ContainerFromItem%2A> ou <xref:System.Windows.Data.CollectionView.IndexOf%2A> para encontrar o local de um item em um <xref:System.Windows.Data.CollectionView> em vez de depender de um local fixo de um item. |
| **Layouts** | Para eliminar re-layouts desnecessários, alterar o <xref:System.Windows.Controls.Page.ShowsNavigationUI> não invalida mais o layout nem faz outro layout passar. | Se você espera que a alteração de <xref:System.Windows.Controls.Page.ShowsNavigationUI> faça outro layout passar, chame <xref:System.Windows.UIElement.InvalidateVisual%2A> depois de definir a propriedade. |
| **Menus** | Para habilitar o texto ClearType nas pop-ups de menu, foram feitas modificações na classe <xref:System.Windows.Controls.ControlTemplate> e no controle <xref:System.Windows.Controls.MenuItem> e em outros controles. | Os aplicativos não devem depender da estrutura visual dos modelos de controle. Apenas partes nomeadas de um <xref:System.Windows.Controls.ControlTemplate> fazem parte do contrato público. Se um aplicativo precisar localizar um determinado objeto em um <xref:System.Windows.Controls.ControlTemplate>, pesquise um tipo específico na árvore visual em vez de depender de um local fixo de um objeto na árvore. |
| **Navegação** | Se um <xref:System.Windows.Controls.Frame> navegar diretamente para um local, a propriedade <xref:System.Windows.Navigation.NavigatingCancelEventArgs.IsNavigationInitiator> será `true` após a navegação inicial. Essa alteração impede eventos adicionais de serem gerados durante os cenários de inicialização. | Nenhum. |
| **Pop-ups** | Agora o delegado <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> pode ser chamado várias vezes durante passagem de um layout em vez de apenas uma vez. | Se seu delegado <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> calcular a posição de um <xref:System.Windows.Controls.Primitives.Popup> com base na posição anterior, recalcule a posição apenas se os valores dos parâmetros `popupSize`, `targetSize` ou `offset` forem alterados. |
| **Valores de propriedade** | O <xref:System.Windows.DependencyObject.SetCurrentValue%2A> método agora permite que você defina uma propriedade como um valor efetivo, embora ela continue a respeitar qualquer associação, estilo ou gatilho que afete a propriedade. | Os autores de controle devem usar <xref:System.Windows.DependencyObject.SetCurrentValue%2A> sempre que o valor da propriedade é alterado como um efeito colateral de alguma outra ação, incluindo a manipulação do usuário. |
| **Caixas de texto** | Para ver considerações de segurança, os métodos <xref:System.Windows.Forms.TextBoxBase.Copy%2A> e <xref:System.Windows.Forms.TextBoxBase.Cut%2A> falham silenciosamente quando são chamados em confiança parcial.<br><br>Além disso, a execução programática da propriedade <xref:System.Windows.Input.ApplicationCommands.Copy> ou <xref:System.Windows.Input.ApplicationCommands.Cut> em um controle herdado de <xref:System.Windows.Controls.Primitives.TextBoxBase> será bloqueada em confiança parcial. No entanto, os comandos copiar e recortar iniciados pelo usuário, como clicar em um botão cuja propriedade <xref:System.Windows.Controls.Primitives.ButtonBase.Command> esteja associada a um desses comandos, funcionarão. O copiar e cortar padrão por meio de atalhos do teclado e o menu de contexto ainda funcionarão como antes em confiança parcial. | Associe o comando <xref:System.Windows.Input.ApplicationCommands.Copy> ou <xref:System.Windows.Input.ApplicationCommands.Cut> a uma ação iniciada pelo usuário, como clicar em um botão. |

### <a name="graphics"></a>Gráficos

Namespaces: <xref:System.Windows> ,,, <xref:System.Windows.Controls> <xref:System.Windows.Data> <xref:System.Windows.Input> ,<xref:System.Windows.Media.Effects>

Assemblies: PresentationFramework (em PresentationFramework.dll), PresentationCore (em PresentationCore.dll), WindowsBase (em WindowsBase.dll)

| Recurso | Diferenças de 3.5 SP1 | Alterações recomendadas |
| ------- | ------------------------ | ------------------- |
| **Efeitos de bitmap** | Para melhorar o desempenho, a classe <xref:System.Windows.Media.Effects.BitmapEffect> e as classes herdadas da classe <xref:System.Windows.Media.Effects.BitmapEffect>, embora ainda presentes, estão desabilitadas. O efeito será renderizado usando o pipeline de renderização acelerado por hardware, se as seguintes condições forem verdadeiras:<br><br>\*O aplicativo usa um <xref:System.Windows.Media.Effects.DropShadowBitmapEffect> ou um <xref:System.Windows.Media.Effects.BlurBitmapEffect> que tem uma propriedade RADIUS definida com menos de 100 DIU.<br>\*A placa de vídeo no computador que executa o aplicativo dá suporte ao pixel shader 2,0.<br><br>Se essas condições não forem atendidas, um objeto <xref:System.Windows.Media.Effects.BitmapEffect> não terá efeito.<br><br>Além disso, o Visual Studio produz um aviso do compilador quando encontra o objeto <xref:System.Windows.Media.Effects.BitmapEffect> ou uma subclasse.<br><br>O método <xref:System.Windows.Media.DrawingContext.PushEffect%2A> está marcado como obsoleto. | Interrompa o uso do <xref:System.Windows.Media.Effects.BitmapEffect> herdado e as classes derivadas e, em vez disso, use as novas classes derivadas de <xref:System.Windows.Media.Effects.Effect>: <xref:System.Windows.Media.Effects.BlurEffect>, <xref:System.Windows.Media.Effects.DropShadowEffect> e <xref:System.Windows.Media.Effects.ShaderEffect>.<br><br>Também é possível criar seus próprios efeitos herdando da classe <xref:System.Windows.Media.Effects.ShaderEffect>. |
| **Quadros de bitmap** | Agora os objetos <xref:System.Windows.Media.Imaging.BitmapFrame> clonados recebem os eventos <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted> e <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed>. Isso permite que as imagens baixadas da Web e aplicadas ao controle <xref:System.Windows.Controls.Image> por meio de um <xref:System.Windows.Style> funcionem corretamente.<br><br>Você verá uma alteração no comportamento apenas se todas as instruções a seguir forem verdadeiras:<br><br>\*Você assina o <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress> evento, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted> ou <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed> .<br>\*A origem do <xref:System.Windows.Media.Imaging.BitmapFrame> é a partir da Web.<br>\*O <xref:System.Windows.Media.Imaging.BitmapFrame> é clonado enquanto o download ainda está em andamento. | Verifique o remetente no manipulador de eventos e execute a ação apenas se o remetente for original <xref:System.Windows.Media.Imaging.BitmapFrame>. |
| **Decodificação de imagens** | Para impedir que um <xref:System.IO.IOException> não seja tratado quando as imagens não puderem ser decodificadas, a classe <xref:System.Windows.Media.Imaging.BitmapSource> gerará o evento <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> quando ele não decodificar uma imagem. | Remova qualquer tratamento de exceções para <xref:System.IO.IOException> e use o evento <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> para verificar se há falha na decodificação. |

### <a name="input"></a>Entrada

Namespaces: <xref:System.Windows> , <xref:System.Windows.Controls> , <xref:System.Windows.Data> ,<xref:System.Windows.Input>

Assemblies: PresentationFramework (em PresentationFramework.dll), PresentationCore (em PresentationCore.dll), WindowsBase (em WindowsBase.dll)

| Recurso | Diferenças de 3.5 SP1 | Alterações recomendadas |
| ------- | ------------------------ | ------------------- |
| **Associação de instâncias de comando** | Para fornecer um mecanismo para associar as instâncias do comando baseado em View-Model para gestos de entrada baseados em View, agora a classe <xref:System.Windows.Input.InputBinding> é herdada de <xref:System.Windows.Freezable> em vez de <xref:System.Windows.DependencyObject>. Agora as seguintes propriedades são propriedades de dependência:<br><br>\* <xref:System.Windows.Input.InputBinding.Command><br>\* <xref:System.Windows.Input.InputBinding.CommandParameter><br>\* <xref:System.Windows.Input.InputBinding.CommandTarget><br><br>Essa alteração resulta no seguinte:<br><br>\*Um <xref:System.Windows.Input.InputBinding> objeto agora é congelado quando ele é registrado em vez de mutável restante.<br>\*Você não pode acessar <xref:System.Windows.Input.InputBinding> objetos em nível de instância de vários threads, devido às restrições da <xref:System.Windows.DependencyObject> classe.<br>\*Não é possível mutar associações de entrada no nível de classe após o registro, devido às restrições da <xref:System.Windows.Freezable> classe.<br>\*Você não pode especificar associações de entrada em instâncias de comando que são criadas em um modelo de exibição. | Crie instâncias separadas de uma classe <xref:System.Windows.Input.InputBinding> em threads separados se as associações precisarem ser mutáveis ou congele-as caso contrário. Não modifique um <xref:System.Windows.Input.InputBinding> estático de nível de classe depois de ele ser registrado. |
| **Aplicativos de navegador** | Agora os .XBAP (aplicativos de navegador do WPF) processam eventos-chave como aplicativos do WPF autônomos para que os objetos recebam eventos-chave roteados na ordem correta. | Nenhum. |
| **Combinações de teclas inativas** | O WPF ofusca teclas inativas, que não produzem nenhum caractere visível, mas, em vez disso, indica que a chave deve ser combinada com a próxima chave de letra para produzir um caractere. Os eventos-chave de entrada, como o evento <xref:System.Windows.Input.Keyboard.KeyDownEvent>, relatam quando uma chave é uma tecla inativa, definindo a propriedade <xref:System.Windows.Input.KeyEventArgs.Key> como o valor <xref:System.Windows.Input.Key>. Geralmente esse é o comportamento esperado, porque os aplicativos normalmente não pretendem responder à entrada do teclado que cria um caractere combinado. | Os aplicativos que esperam ler as chaves que faziam parte de caracteres combinadas podem obter a chave agora ofuscada usando a propriedade <xref:System.Windows.Input.KeyEventArgs.DeadCharProcessedKey>. |
| **Gerenciador de foco** | Quando o método <xref:System.Windows.Input.FocusManager.GetFocusedElement(System.Windows.DependencyObject)?displayProperty=nameWithType> receber um elemento que tem a propriedade anexada [IsFocusScope](xref:System.Windows.Input.FocusManager.IsFocusScope%2A) definida como `true`, o método retornará um elemento que é o último elemento de foco no teclado dentro do escopo desse foco se e somente se o elemento retornado pertencer ao mesmo objeto <xref:System.Windows.PresentationSource> que o elemento passado para o método. | Nenhum. |

### <a name="ui-automation"></a>Automação da Interface de Usuário

Namespace:,,,,, <xref:System.Windows> <xref:System.Windows.Automation.Peers> <xref:System.Windows.Automation.Provider> <xref:System.Windows.Controls> <xref:System.Windows.Data><xref:System.Windows.Input>

Assemblies: PresentationFramework (em PresentationFramework.dll), PresentationCore (em PresentationCore.dll), UIAutomationProvider (em UIAutomationProvider.dll), WindowsBase (em WindowsBase.dll)

| Recurso | Diferenças de 3.5 SP1 | Alterações recomendadas |
| ------- | ------------------------ | ------------------- |
| **Hierarquia de classe de exibições** | As classes <xref:System.Windows.Automation.Peers.TreeViewAutomationPeer> e <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> são herdadas de <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer> em vez de <xref:System.Windows.Automation.Peers.FrameworkElementAutomationPeer>. | Se você herdar das classes <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> e substituir o método <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer.GetChildrenCore%2A>, considere retornar um objeto herdado da nova classe <xref:System.Windows.Automation.Peers.TreeViewDataItemAutomationPeer>. |
| **Contêineres fora da tela** | Para corrigir um valor retornado incorreto, agora o método <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.IsOffscreenCore%2A> retorna corretamente `false` para contêineres de itens rolados para fora da exibição. Além disso, o valor do método não é afetado por oclusão por outras janelas ou se o elemento está visível em um monitor específico. | Nenhum. |
| **Menus e objetos filho** | Para habilitar a automação da interface do usuário dos menus que contêm filhos diferentes de objetos <xref:System.Windows.Controls.MenuItem>, agora o método <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer.GetChildrenCore%2A> retorna o objeto <xref:System.Windows.Automation.Peers.AutomationPeer> de um objeto <xref:System.Windows.UIElement> filho, em vez de um objeto <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer>. | Nenhum. |
| **Novas interfaces e assembly** | Para habilitar novos recursos de automação de interface do usuário, as interfaces a seguir foram adicionadas:<br><br>\* <xref:System.Windows.Automation.Provider.IItemContainerProvider><br>\* <xref:System.Windows.Automation.Provider.ISynchronizedInputProvider><br>\* <xref:System.Windows.Automation.Provider.IVirtualizedItemProvider> | Qualquer projeto que cria pares de automação do WPF deve adicionar uma referência explícita a UIAutomationProvider.dll. |
| **Miniaturas** | O método <xref:System.Windows.Automation.Peers.ThumbAutomationPeer.GetClassNameCore%2A> retorna um valor em vez de null. Portanto, controles como <xref:System.Windows.Controls.GridSplitter> herdados da classe <xref:System.Windows.Controls.Primitives.Thumb> relatarão um nome para a automação da interface do usuário. | Nenhum. |
| **Elementos virtualizados** | Para aprimorar o desempenho, o método <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetChildrenCore%2A> retorna apenas os objetos filho que realmente estão na árvore visual, em vez de todos os objetos filho, independentemente se eles são virtualizados. | Use <xref:System.Windows.Automation.ItemContainerPattern> para iterar em todos os itens de um <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer>. |

### <a name="xaml"></a>XAML

Namespaces: <xref:System.Windows> ,,, <xref:System.Windows.Controls> <xref:System.Windows.Data> <xref:System.Windows.Input> ,<xref:System.Windows.Markup>

Assemblies: PresentationFramework (em PresentationFramework.dll), PresentationCore (em PresentationCore.dll), WindowsBase (em WindowsBase.dll)

| Recurso | Diferenças de 3.5 SP1 | Alterações recomendadas |
| ------- | ------------------------ | ------------------- |
| **Extensão de marcação** | Agora o WPF sempre usa corretamente o valor do método <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A> em vez de retornar o objeto <xref:System.Windows.Markup.MarkupExtension> em determinados casos quando uma extensão de marcação é usada para definir uma propriedade ou para criar um item em uma coleção. Uma extensão de marcação pode retornar a si mesma em alguns casos. | Se seu aplicativo acessar um recurso que retornou um objeto <xref:System.Windows.Markup.MarkupExtension> em versões anteriores, referencie o objeto retornado de <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A>, em vez do objeto <xref:System.Windows.Markup.MarkupExtension>. |
| **Análise de atributos** | Agora os atributos em XAML podem ter apenas um ponto. Por exemplo, é válido o seguinte:<br><br>`<Button Background="Red"/>` (nenhum ponto)<br><br>`<Button Button.Background = "Red"/>` (um ponto)<br><br>O exemplo a seguir não é mais válido:<br><br>`<Button Control.Button.Background = "Red"/>` (mais de um ponto) | Atributos XAML corretos que têm mais de um período. |

## <a name="xml"></a>XML

As linhas desta tabela descrevem aprimoramentos em recursos que anteriormente tinham limitações ou outros problemas.

### <a name="schema-and-transforms"></a>Esquema e transformações

Namespaces: <xref:System.Xml.Linq> ; <xref:System.Xml.Schema> ,<xref:System.Xml.XPath>

Assemblies: System.Xml (em System.Xml.dll), System.Xml. LINQ (em System.Xml.Linq.dll)

| Recurso | Diferenças de 3.5 SP1 |
| ------- | ------------------------ |
| **Esquemas Chameleon** | Para evitar dados corrompidos, agora os esquemas Chameleon são clonados corretamente quando são incluídos com vários esquemas.<br><br>Os esquemas Chameleon são esquemas que não têm um namespace de destino e quando eles são incluídos em outro XSD, eles assumem o namespace de destino do esquema de importação. Geralmente, eles são usados para incluir tipos comuns em um esquema. |
| **Funções de ID** | Agora a [função de ID](/sql/xquery/functions-on-sequences-id) XSLT retorna o valor correto, em vez de null quando um objeto <xref:System.Xml.XmlReader> é passado para um XSLT.<br><br>Se o usuário criou um objeto <xref:System.Xml.XmlReader> de uma classe LINQ to XML usando o método <xref:System.Xml.Linq.XNode.CreateReader%2A> e esse objeto <xref:System.Xml.XmlReader> foi passado para um XSLT, quaisquer instâncias da função `id` no XSLT anteriormente retornavam null. Esse não é um valor retornado permitido para a função `id`. |
| **Atributo de namespace** | Para evitar dados corrompidos, agora um objeto <xref:System.Xml.XPath.XPathNavigator> retorna o nome local do atributo `x:xmlns` corretamente. |
| **Declarações de namespace** | Um <xref:System.Xml.XmlReader> objeto em uma subárvore não cria declarações de namespace duplicadas dentro de um elemento XML. |
| **Validação de esquema** | Para impedir uma validação do esquema incorreta, a classe <xref:System.Xml.Schema.XmlSchemaSet> permite que esquemas XSD sejam compilados de maneira correta e consistente. Esses esquemas podem incluir outros esquemas; por exemplo, `A.xsd` pode incluir `B.xsd`, que pode incluir `C.xsd`. A compilação de qualquer um desses exemplos faz o grafo de dependências ser atravessado. |
| **Funções de script** | A [função function-available](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms256124(v=vs.100)) não retorna mais `false` incorretamente quando a função está realmente disponível. |
| **URIs** | Agora o método <xref:System.Xml.Linq.XElement.Load%2A> retorna o BaseURI correto em consultas LINQ. |

### <a name="validation"></a>Validação

Namespaces: <xref:System.Xml.Linq> ; <xref:System.Xml.Schema> ,<xref:System.Xml.XPath>

Assemblies: System.Xml (em System.Xml.dll), System.Xml. LINQ (em System.Xml.Linq.dll)

| Recurso | Diferenças de 3.5 SP1 |
| ------- | ------------------------ |
| **Resolvedores de namespace** | O método <xref:System.Xml.XmlReader.ReadContentAs%2A> não ignora mais o resolvedor <xref:System.Xml.IXmlNamespaceResolver> passado para ele.<br><br>Nas versões anteriores, o resolvedor de namespace especificado foi ignorado e o <xref:System.Xml.XmlReader> foi usado. |
| **Espaço em branco** | Para evitar a perda de dados quando você estiver criando um leitor, o método <xref:System.Xml.XmlReader.Create%2A> não descarta mais espaços em branco significativos.<br><br>A validação de XML reconhece o modo de conteúdo misto, no qual o texto pode ser mesclado com a marcação XML. No modo misto, qualquer espaço em branco é significativo e deve ser relatado. |

### <a name="writing"></a>Gravando

Namespaces: <xref:System.Xml.Linq> ; <xref:System.Xml.Schema> ,<xref:System.Xml.XPath>

Assemblies: System.Xml (em System.Xml.dll), System.Xml. LINQ (em System.Xml.Linq.dll)

| Recurso | Diferenças de 3.5 SP1 |
| ------- | ------------------------ |
| **Referências de entidade** | Para evitar dados corrompidos, as referências de entidade não são mais criadas duas vezes em atributos XML.<br><br>Se o usuário tentou gravar uma entidade em um atributo `xmlns` ou em um atributo `xml:lang` ou `xml:space` usando o método <xref:System.Xml.XmlWriter.WriteEntityRef%2A>, a entidade foi criada duas vezes na saída, corrompendo, portanto, os dados. |
| **Tratamento de nova linha** | Para evitar dados corrompidos, os objetos <xref:System.Xml.XmlWriter> respeitam a opção <xref:System.Xml.NewLineHandling>. |

## <a name="see-also"></a>Consulte também

- [Novos tipos e membros no .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff641764%28v=vs.100%29)
- [Guia de migração para .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff657133%28v=vs.100%29)
- [O que há de novo no .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms171868%28v=vs.100%29)
- [Compatibilidade de versão no .NET Framework](version-compatibility.md)
- [Migrando soluções do Office para o .NET Framework 4](/visualstudio/vsto/migrating-office-solutions-to-the-dotnet-framework-4-or-later)
- [O que está obsoleto na biblioteca de classes .NET Framework](../whats-new/whats-obsolete.md)
