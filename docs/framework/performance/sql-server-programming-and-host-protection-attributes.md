---
title: Programação em SQL Server e atributos de proteção de host
description: Introdução aos atributos de proteção de host e programação de SQL Server. Examine SQL Server conjuntos de permissões e restrições de modelo de programação.
ms.date: 03/30/2017
helpviewer_keywords:
- SQL Server [.NET Framework]
- permission sets, SQL Server
- SQL Server Programming and Host Protection Attributes
- managed code, SQL Server
- reliability [.NET Framework]
- writing reliable code
- hosts, reliability
- host protection attributes
- HostProtectionAttribute class, reliability
ms.assetid: 7dfa36b4-e773-4c75-a3ff-ff1af3ce4c4f
ms.openlocfilehash: 33db32897d2f49d2c10f94dc73aeae728c17db73
ms.sourcegitcommit: cf5a800a33de64d0aad6d115ffcc935f32375164
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/20/2020
ms.locfileid: "86474196"
---
# <a name="sql-server-programming-and-host-protection-attributes"></a>Programação em SQL Server e atributos de proteção de host
A capacidade de carregar e executar um código gerenciado em um host do SQL Server exige que os requisitos do host referentes à segurança de acesso do código e à proteção de recursos do host sejam atendidos.  Os requisitos de segurança de acesso do código são especificados por um dos três conjuntos de permissões do SQL Server: SAFE, EXTERNAL-ACCESS ou UNSAFE. O código em execução nos conjuntos de permissões SAFE ou EXTERNAL-ACCESS devem evitar determinados tipos ou membros que têm o atributo <xref:System.Security.Permissions.HostProtectionAttribute> aplicado. O <xref:System.Security.Permissions.HostProtectionAttribute> não é uma permissão de segurança como uma garantia de confiabilidade, pois ele identifica constructos de código específicos, sejam tipos ou métodos, que o host pode não permitir.  O uso do <xref:System.Security.Permissions.HostProtectionAttribute> impõe um modelo de programação que ajuda a proteger a estabilidade do host.  
  
## <a name="host-protection-attributes"></a>Atributos de proteção de host  
 Os atributos de proteção do host identificam tipos ou membros que não se ajustam ao modelo de programação do host e representam os seguintes níveis cada vez maiores de ameaça à confiabilidade:  
  
- Do contrário, benignos.  
  
- Poderia levar à desestabilização do código de usuário gerenciado por servidor.  
  
- Poderia levar à desestabilização do próprio processo do servidor.  
  
 O SQL Server não permite o uso de um tipo ou membro que tem um <xref:System.Security.Permissions.HostProtectionAttribute> que especifica um valor <xref:System.Security.Permissions.HostProtectionResource> igual a <xref:System.Security.Permissions.HostProtectionResource.SharedState>, <xref:System.Security.Permissions.HostProtectionResource.Synchronization>, <xref:System.Security.Permissions.HostProtectionResource.MayLeakOnAbort> ou <xref:System.Security.Permissions.HostProtectionResource.ExternalProcessMgmt>. Isso impede que os assemblies chamem membros que permitem o compartilhamento do estado, executam a sincronização, podem causar uma perda de recursos após o término ou afetam a integridade do processo do SQL Server.  
  
### <a name="disallowed-types-and-members"></a>Tipos e membros desaprovados  
 A tabela a seguir identifica os tipos e membros cujos valores <xref:System.Security.Permissions.HostProtectionResource> não são permitidos pelo SQL Server.  
  
|Namespace|Tipo ou membro|  
|---------------|--------------------|  
|`Microsoft.Win32`|Classe <xref:Microsoft.Win32.PowerModeChangedEventArgs><br /><br /> Representante <xref:Microsoft.Win32.PowerModeChangedEventHandler><br /><br /> Classe <xref:Microsoft.Win32.SessionEndedEventArgs><br /><br /> Representante <xref:Microsoft.Win32.SessionEndedEventHandler><br /><br /> Classe <xref:Microsoft.Win32.SessionEndingEventArgs><br /><br /> Representante <xref:Microsoft.Win32.SessionEndingEventHandler><br /><br /> Classe <xref:Microsoft.Win32.SessionSwitchEventArgs><br /><br /> Representante <xref:Microsoft.Win32.SessionSwitchEventHandler><br /><br /> Classe <xref:Microsoft.Win32.SystemEvents><br /><br /> Classe <xref:Microsoft.Win32.TimerElapsedEventArgs><br /><br /> Representante <xref:Microsoft.Win32.TimerElapsedEventHandler><br /><br /> Classe <xref:Microsoft.Win32.UserPreferenceChangedEventArgs><br /><br /> Classe <xref:Microsoft.Win32.UserPreferenceChangingEventArgs>|  
|`System.Collections`|Método <xref:System.Collections.ArrayList.Synchronized%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.Collections.Hashtable.Synchronized%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.Collections.Queue.Synchronized%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.Collections.SortedList.Synchronized%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.Collections.Stack.Synchronized%2A?displayProperty=nameWithType>|  
|`System.ComponentModel`|Classe <xref:System.ComponentModel.AddingNewEventArgs><br /><br /> Representante <xref:System.ComponentModel.AddingNewEventHandler><br /><br /> Classe <xref:System.ComponentModel.ArrayConverter><br /><br /> Classe <xref:System.ComponentModel.AsyncCompletedEventArgs><br /><br /> Representante <xref:System.ComponentModel.AsyncCompletedEventHandler><br /><br /> Classe <xref:System.ComponentModel.AsyncOperation><br /><br /> Classe <xref:System.ComponentModel.AsyncOperationManager><br /><br /> Classe <xref:System.ComponentModel.AttributeCollection><br /><br /> Classe <xref:System.ComponentModel.BackgroundWorker><br /><br /> Classe <xref:System.ComponentModel.BaseNumberConverter><br /><br /> Classe <xref:System.ComponentModel.BindingList%601><br /><br /> Classe <xref:System.ComponentModel.BooleanConverter><br /><br /> Classe <xref:System.ComponentModel.ByteConverter><br /><br /> Classe <xref:System.ComponentModel.CancelEventArgs><br /><br /> Representante <xref:System.ComponentModel.CancelEventHandler><br /><br /> Classe <xref:System.ComponentModel.CharConverter><br /><br /> Classe <xref:System.ComponentModel.CollectionChangeEventArgs><br /><br /> Representante <xref:System.ComponentModel.CollectionChangeEventHandler><br /><br /> Classe <xref:System.ComponentModel.CollectionConverter><br /><br /> Classe <xref:System.ComponentModel.ComponentCollection><br /><br /> Classe <xref:System.ComponentModel.ComponentConverter><br /><br /> Classe <xref:System.ComponentModel.ComponentEditor><br /><br /> Classe <xref:System.ComponentModel.ComponentResourceManager><br /><br /> Classe <xref:System.ComponentModel.Container><br /><br /> Classe <xref:System.ComponentModel.ContainerFilterService><br /><br /> Classe <xref:System.ComponentModel.CultureInfoConverter><br /><br /> Classe <xref:System.ComponentModel.CustomTypeDescriptor><br /><br /> Classe <xref:System.ComponentModel.DateTimeConverter><br /><br /> Classe <xref:System.ComponentModel.DecimalConverter><br /><br /> Classe <xref:System.ComponentModel.Design.ActiveDesignerEventArgs><br /><br /> Representante <xref:System.ComponentModel.Design.ActiveDesignerEventHandler><br /><br /> Classe <xref:System.ComponentModel.Design.CheckoutException><br /><br /> Classe <xref:System.ComponentModel.Design.CommandID><br /><br /> Classe <xref:System.ComponentModel.Design.ComponentChangedEventArgs><br /><br /> Representante <xref:System.ComponentModel.Design.ComponentChangedEventHandler><br /><br /> Classe <xref:System.ComponentModel.Design.ComponentChangingEventArgs><br /><br /> Representante <xref:System.ComponentModel.Design.ComponentChangingEventHandler><br /><br /> Classe <xref:System.ComponentModel.Design.ComponentEventArgs><br /><br /> Representante <xref:System.ComponentModel.Design.ComponentEventHandler><br /><br /> Classe <xref:System.ComponentModel.Design.ComponentRenameEventArgs><br /><br /> Representante <xref:System.ComponentModel.Design.ComponentRenameEventHandler><br /><br /> Classe <xref:System.ComponentModel.Design.DesignerCollection><br /><br /> Classe <xref:System.ComponentModel.Design.DesignerEventArgs><br /><br /> Representante <xref:System.ComponentModel.Design.DesignerEventHandler><br /><br /> Classe <xref:System.ComponentModel.Design.DesignerOptionService><br /><br /> Classe <xref:System.ComponentModel.Design.DesignerTransaction><br /><br /> Classe <xref:System.ComponentModel.Design.DesignerTransactionCloseEventArgs><br /><br /> Representante <xref:System.ComponentModel.Design.DesignerTransactionCloseEventHandler><br /><br /> Classe <xref:System.ComponentModel.Design.DesignerVerb><br /><br /> Classe <xref:System.ComponentModel.Design.DesignerVerbCollection><br /><br /> Classe <xref:System.ComponentModel.Design.DesigntimeLicenseContext><br /><br /> Classe <xref:System.ComponentModel.Design.DesigntimeLicenseContextSerializer><br /><br /> Classe <xref:System.ComponentModel.Design.MenuCommand><br /><br /> Classe <xref:System.ComponentModel.Design.Serialization.ComponentSerializationService><br /><br /> Classe <xref:System.ComponentModel.Design.Serialization.ContextStack><br /><br /> Classe <xref:System.ComponentModel.Design.Serialization.DesignerLoader><br /><br /> Classe <xref:System.ComponentModel.Design.Serialization.InstanceDescriptor><br /><br /> Classe <xref:System.ComponentModel.Design.Serialization.MemberRelationshipService><br /><br /> Classe <xref:System.ComponentModel.Design.Serialization.ResolveNameEventArgs><br /><br /> Representante <xref:System.ComponentModel.Design.Serialization.ResolveNameEventHandler><br /><br /> Classe <xref:System.ComponentModel.Design.Serialization.SerializationStore><br /><br /> Classe <xref:System.ComponentModel.Design.ServiceContainer><br /><br /> Representante <xref:System.ComponentModel.Design.ServiceCreatorCallback><br /><br /> Classe <xref:System.ComponentModel.Design.StandardCommands><br /><br /> Classe <xref:System.ComponentModel.Design.StandardToolWindows><br /><br /> Classe <xref:System.ComponentModel.DoubleConverter><br /><br /> Classe <xref:System.ComponentModel.DoWorkEventArgs><br /><br /> Representante <xref:System.ComponentModel.DoWorkEventHandler><br /><br /> Classe <xref:System.ComponentModel.EnumConverter><br /><br /> Classe <xref:System.ComponentModel.EventDescriptor><br /><br /> Classe <xref:System.ComponentModel.EventDescriptorCollection><br /><br /> Classe <xref:System.ComponentModel.EventHandlerList><br /><br /> Classe <xref:System.ComponentModel.ExpandableObjectConverter><br /><br /> Classe <xref:System.ComponentModel.HandledEventArgs><br /><br /> Representante <xref:System.ComponentModel.HandledEventHandler><br /><br /> Classe <xref:System.ComponentModel.InstanceCreationEditor><br /><br /> Classe <xref:System.ComponentModel.Int16Converter><br /><br /> Classe <xref:System.ComponentModel.Int32Converter><br /><br /> Classe <xref:System.ComponentModel.Int64Converter><br /><br /> Classe <xref:System.ComponentModel.InvalidAsynchronousStateException><br /><br /> Classe <xref:System.ComponentModel.InvalidEnumArgumentException><br /><br /> Método <xref:System.ComponentModel.ISynchronizeInvoke.BeginInvoke%2A><br /><br /> Classe <xref:System.ComponentModel.License><br /><br /> Classe <xref:System.ComponentModel.LicenseContext><br /><br /> Classe <xref:System.ComponentModel.LicenseException><br /><br /> Classe <xref:System.ComponentModel.LicenseManager><br /><br /> Classe <xref:System.ComponentModel.LicenseProvider><br /><br /> Classe <xref:System.ComponentModel.LicFileLicenseProvider><br /><br /> Classe <xref:System.ComponentModel.ListChangedEventArgs><br /><br /> Representante <xref:System.ComponentModel.ListChangedEventHandler><br /><br /> Classe <xref:System.ComponentModel.ListSortDescription><br /><br /> Classe <xref:System.ComponentModel.ListSortDescriptionCollection><br /><br /> Classe <xref:System.ComponentModel.MaskedTextProvider><br /><br /> Classe <xref:System.ComponentModel.MemberDescriptor><br /><br /> Classe <xref:System.ComponentModel.MultilineStringConverter><br /><br /> Classe <xref:System.ComponentModel.NestedContainer><br /><br /> Classe <xref:System.ComponentModel.NullableConverter><br /><br /> Classe <xref:System.ComponentModel.ProgressChangedEventArgs><br /><br /> Representante <xref:System.ComponentModel.ProgressChangedEventHandler><br /><br /> Classe <xref:System.ComponentModel.PropertyChangedEventArgs><br /><br /> Representante <xref:System.ComponentModel.PropertyChangedEventHandler><br /><br /> Classe <xref:System.ComponentModel.PropertyDescriptor><br /><br /> Classe <xref:System.ComponentModel.PropertyDescriptorCollection><br /><br /> Classe <xref:System.ComponentModel.ReferenceConverter><br /><br /> Classe <xref:System.ComponentModel.RefreshEventArgs><br /><br /> Representante <xref:System.ComponentModel.RefreshEventHandler><br /><br /> Classe <xref:System.ComponentModel.RunWorkerCompletedEventArgs><br /><br /> Representante <xref:System.ComponentModel.RunWorkerCompletedEventHandler><br /><br /> Classe <xref:System.ComponentModel.SByteConverter><br /><br /> Classe <xref:System.ComponentModel.SingleConverter><br /><br /> Classe <xref:System.ComponentModel.StringConverter><br /><br /> Classe <xref:System.ComponentModel.SyntaxCheck><br /><br /> Classe <xref:System.ComponentModel.TimeSpanConverter><br /><br /> Classe <xref:System.ComponentModel.TypeConverter><br /><br /> Classe <xref:System.ComponentModel.TypeDescriptionProvider><br /><br /> Classe <xref:System.ComponentModel.TypeDescriptor><br /><br /> Classe <xref:System.ComponentModel.TypeListConverter><br /><br /> Classe <xref:System.ComponentModel.UInt16Converter><br /><br /> Classe <xref:System.ComponentModel.UInt32Converter><br /><br /> Classe <xref:System.ComponentModel.UInt64Converter><br /><br /> Classe <xref:System.ComponentModel.WarningException><br /><br /> Classe <xref:System.ComponentModel.Win32Exception>|  
|`System.Diagnostics`|Propriedade <xref:System.Diagnostics.Debug.Listeners%2A?displayProperty=nameWithType><br /><br /> Propriedade <xref:System.Diagnostics.Trace.Listeners%2A?displayProperty=nameWithType><br /><br /> Propriedade <xref:System.Diagnostics.EventLog.SynchronizingObject%2A?displayProperty=nameWithType><br /><br /> Classe <xref:System.Diagnostics.ConsoleTraceListener><br /><br /> Classe <xref:System.Diagnostics.DefaultTraceListener><br /><br /> Classe <xref:System.Diagnostics.DelimitedListTraceListener><br /><br /> Classe <xref:System.Diagnostics.EventLogTraceListener><br /><br /> Classe <xref:System.Diagnostics.PerformanceCounter><br /><br /> Classe <xref:System.Diagnostics.PerformanceCounterCategory><br /><br /> Classe <xref:System.Diagnostics.Process><br /><br /> Classe <xref:System.Diagnostics.ProcessStartInfo><br /><br /> Classe <xref:System.Diagnostics.TextWriterTraceListener><br /><br /> Classe <xref:System.Diagnostics.TraceListener><br /><br /> Classe <xref:System.Diagnostics.XmlWriterTraceListener><br /><br /> Propriedade <xref:System.Diagnostics.TraceSource.Listeners%2A?displayProperty=nameWithType>|  
|`System.IO`|Método <xref:System.IO.Stream.Synchronized%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.IO.TextReader.Synchronized%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.IO.TextWriter.Synchronized%2A?displayProperty=nameWithType>|  
|`System.Reflection.Emit`|Classe <xref:System.Reflection.Emit.ConstructorBuilder><br /><br /> Classe <xref:System.Reflection.Emit.EventBuilder><br /><br /> Classe <xref:System.Reflection.Emit.FieldBuilder><br /><br /> Classe <xref:System.Reflection.Emit.MethodBuilder><br /><br /> Classe <xref:System.Reflection.Emit.CustomAttributeBuilder><br /><br /> Classe <xref:System.Reflection.Emit.MethodRental><br /><br /> Classe <xref:System.Reflection.Emit.ModuleBuilder><br /><br /> Classe <xref:System.Reflection.Emit.PropertyBuilder><br /><br /> Classe <xref:System.Reflection.Emit.TypeBuilder><br /><br /> Classe <xref:System.Reflection.Emit.UnmanagedMarshal>|  
|`System.Text`|Método <xref:System.Text.RegularExpressions.Group.Synchronized%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.Text.RegularExpressions.Match.Synchronized%2A?displayProperty=nameWithType>|  
|`System.Threading`|Classe <xref:System.Threading.AutoResetEvent><br /><br /> Classe <xref:System.Threading.EventWaitHandle><br /><br /> Classe <xref:System.Threading.ManualResetEvent><br /><br /> Classe <xref:System.Threading.Monitor><br /><br /> Classe <xref:System.Threading.Mutex><br /><br /> Classe <xref:System.Threading.ReaderWriterLock><br /><br /> Classe <xref:System.Threading.Semaphore><br /><br /> Método <xref:System.Threading.Thread.AllocateNamedDataSlot%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.Threading.Thread.BeginCriticalRegion%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.Threading.Thread.EndCriticalRegion%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.Threading.Thread.FreeNamedDataSlot%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.Threading.Thread.GetData%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.Threading.Thread.SetApartmentState%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.Threading.Thread.SetData%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.Threading.Thread.SpinWait%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType><br /><br /> Método <xref:System.Threading.Thread.TrySetApartmentState%2A?displayProperty=nameWithType><br /><br /> Classe <xref:System.Threading.ThreadPool><br /><br /> Classe <xref:System.Threading.Timer>|  
|`System.Timers`|Classe <xref:System.Timers.Timer>|  
|`System.Web.Configuration`|Classe <xref:System.Web.Configuration.MachineKeyValidationConverter>|  
|`System.Windows.Forms`|Propriedade <xref:System.Windows.Forms.AutoCompleteStringCollection.SyncRoot%2A?displayProperty=nameWithType>|  
  
## <a name="sql-server-permission-sets"></a>Conjuntos de permissões do SQL Server  
 O SQL Server permite aos usuários especificar os requisitos de confiabilidade do código implantado em um banco de dados. Quando os assemblies são carregados no banco de dados, o autor do assembly pode especificar um dos três conjuntos de permissões para o assembly: SAFE, EXTERNAL-ACCESS ou UNSAFE.  
  
|Conjunto de permissões|SAFE|EXTERNAL-ACCESS|UNSAFE|  
|--------------------|----------|----------------------|------------|  
|Segurança de acesso do código|Somente execução|Execução + acesso a recursos externos|Irrestrito|  
|Restrições do modelo de programação|Sim|Sim|Sem restrições|  
|Requisito de verificabilidade|Sim|Sim|Não|  
|Capacidade de chamar código nativo|Não|Não|Sim|  
  
 SAFE é o modo mais confiável e seguro, com restrições associadas ao modelo de programação permitido. O código SAFE tem recursos de alta confiabilidade e segurança. Assemblies SAFE recebem permissão suficiente para executar, realizar cálculos e ter acesso ao banco de dados local. Assemblies SAFE precisam ser seguros do tipo verificável e não têm permissão para chamar código não gerenciado.  
  
 EXTERNAL-ACCESS fornece uma opção de segurança intermediária, permitindo que o código acesse recursos externos ao banco de dados, mas ainda tenha a confiabilidade e a segurança de SAFE.  
  
 UNSAFE é para código altamente confiável que pode ser criado somente por administradores de bancos de dados. Esses códigos confiáveis não têm nenhuma restrição de acesso do código e podem chamar um código não gerenciado (nativo).  
  
 O SQL Server usa a camada da política de segurança de acesso do código em nível de host para configurar uma política de host que concede um dos três conjuntos de permissões, com base no conjunto de permissões armazenado nos catálogos do SQL Server. Código gerenciado em execução dentro do banco de dados sempre obtém um desses conjuntos de permissão de acesso de código.  
  
## <a name="programming-model-restrictions"></a>Restrições do Modelo de Programação  
 O modelo de programação de código gerenciado no SQL Server exige funções, procedimentos e tipos que não exigem que o uso do estado seja mantido em várias invocações nem exigem o compartilhamento do estado entre várias sessões do usuário. Além disso, conforme descrito anteriormente, a presença do estado compartilhado pode causar exceções críticas que afetam a escalabilidade e a confiabilidade do aplicativo.  
  
 Com base nessas considerações, o SQL Server não permite o uso de variáveis estáticas e membros de dados estáticos. Para assemblies SAFE e EXTERNAL-ACCESS, o SQL Server examina os metadados do assembly em tempo CREATE ASSEMBLY e falha a criação desses assemblies se encontra o uso de variáveis e membros de dados estáticos.  
  
## <a name="see-also"></a>Confira também

- <xref:System.Security.Permissions.HostProtectionAttribute>
- <xref:System.Security.Permissions.HostProtectionResource>
